<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用原生 JS 实现事件委托 | 前端知识架构</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/web/favicon.ico">
    <meta name="description" content="一份耕耘，一份收获">
    <link rel="preload" href="/web/assets/css/0.styles.2154e1d6.css" as="style"><link rel="preload" href="/web/assets/js/app.8467f5ab.js" as="script"><link rel="preload" href="/web/assets/js/2.8d3b33bd.js" as="script"><link rel="preload" href="/web/assets/js/25.42103518.js" as="script"><link rel="prefetch" href="/web/assets/js/10.7a01bfe0.js"><link rel="prefetch" href="/web/assets/js/11.9434c272.js"><link rel="prefetch" href="/web/assets/js/12.9e6f10b2.js"><link rel="prefetch" href="/web/assets/js/13.fe0ef855.js"><link rel="prefetch" href="/web/assets/js/14.302f4517.js"><link rel="prefetch" href="/web/assets/js/15.660f56d4.js"><link rel="prefetch" href="/web/assets/js/16.46fc2947.js"><link rel="prefetch" href="/web/assets/js/17.d3cd12e3.js"><link rel="prefetch" href="/web/assets/js/18.8494a138.js"><link rel="prefetch" href="/web/assets/js/19.3a3d2df5.js"><link rel="prefetch" href="/web/assets/js/20.f5a53c39.js"><link rel="prefetch" href="/web/assets/js/21.030b82b6.js"><link rel="prefetch" href="/web/assets/js/22.d8388d13.js"><link rel="prefetch" href="/web/assets/js/23.fbc73fa5.js"><link rel="prefetch" href="/web/assets/js/24.e744a1f2.js"><link rel="prefetch" href="/web/assets/js/26.f7f69a1c.js"><link rel="prefetch" href="/web/assets/js/27.e99a3e44.js"><link rel="prefetch" href="/web/assets/js/28.909292b8.js"><link rel="prefetch" href="/web/assets/js/29.ad2475de.js"><link rel="prefetch" href="/web/assets/js/3.ccafea9f.js"><link rel="prefetch" href="/web/assets/js/30.d8597d9b.js"><link rel="prefetch" href="/web/assets/js/31.35764e69.js"><link rel="prefetch" href="/web/assets/js/32.bded8736.js"><link rel="prefetch" href="/web/assets/js/33.ed94c720.js"><link rel="prefetch" href="/web/assets/js/34.73a7c58c.js"><link rel="prefetch" href="/web/assets/js/35.513744f0.js"><link rel="prefetch" href="/web/assets/js/36.54a10e5d.js"><link rel="prefetch" href="/web/assets/js/37.0b875606.js"><link rel="prefetch" href="/web/assets/js/38.d1fd942d.js"><link rel="prefetch" href="/web/assets/js/39.391eb545.js"><link rel="prefetch" href="/web/assets/js/4.b7e6892f.js"><link rel="prefetch" href="/web/assets/js/40.6b58055b.js"><link rel="prefetch" href="/web/assets/js/41.18a47a08.js"><link rel="prefetch" href="/web/assets/js/42.bdc55719.js"><link rel="prefetch" href="/web/assets/js/43.ceab86cf.js"><link rel="prefetch" href="/web/assets/js/44.3f570633.js"><link rel="prefetch" href="/web/assets/js/45.cf947904.js"><link rel="prefetch" href="/web/assets/js/46.d54563a9.js"><link rel="prefetch" href="/web/assets/js/47.295b8176.js"><link rel="prefetch" href="/web/assets/js/48.dcecab73.js"><link rel="prefetch" href="/web/assets/js/49.30ed491b.js"><link rel="prefetch" href="/web/assets/js/5.98ae611d.js"><link rel="prefetch" href="/web/assets/js/6.a45f1e7c.js"><link rel="prefetch" href="/web/assets/js/7.749a3a54.js"><link rel="prefetch" href="/web/assets/js/8.17709c3b.js"><link rel="prefetch" href="/web/assets/js/9.69409426.js">
    <link rel="stylesheet" href="/web/assets/css/0.styles.2154e1d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web/" class="home-link router-link-active"><!----> <span class="site-name">前端知识架构</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/basic/JavaScript/" class="nav-link router-link-active">
  基础知识
</a></div><div class="nav-item"><a href="/web/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/web/net/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/web/performance/" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/web/vue/" class="nav-link">
  Vue
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/basic/JavaScript/" class="nav-link router-link-active">
  基础知识
</a></div><div class="nav-item"><a href="/web/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/web/net/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/web/performance/" class="nav-link">
  性能优化
</a></div><div class="nav-item"><a href="/web/vue/" class="nav-link">
  Vue
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/web/basic/JavaScript/" class="sidebar-heading clickable router-link-active open"><span>JavaScript</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/basic/JavaScript/type.html" class="sidebar-link">类型</a></li><li><a href="/web/basic/JavaScript/function.html" class="sidebar-link">函数</a></li><li><a href="/web/basic/JavaScript/object.html" class="sidebar-link">面向对象</a></li><li><a href="/web/basic/JavaScript/nonfunctions-closures.html" class="sidebar-link">匿名函数与闭包</a></li><li><a href="/web/basic/JavaScript/this.html" class="sidebar-link">this指向</a></li><li><a href="/web/basic/JavaScript/json.html" class="sidebar-link">JSON</a></li><li><a href="/web/basic/JavaScript/RegExp.html" class="sidebar-link">正则表达式RegExp</a></li><li><a href="/web/basic/JavaScript/cookie.html" class="sidebar-link">cookie</a></li><li><a href="/web/basic/JavaScript/Date.html" class="sidebar-link">Date</a></li><li><a href="/web/basic/JavaScript/shallow-copy.html" class="sidebar-link">浅复制</a></li><li><a href="/web/basic/JavaScript/deep-copy.html" class="sidebar-link">深复制</a></li><li><a href="/web/basic/JavaScript/ajax.html" class="sidebar-link">Ajax</a></li><li><a href="/web/basic/JavaScript/error.html" class="sidebar-link">错误处理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/web/basic/CSS/" class="sidebar-heading clickable"><span>CSS</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/web/basic/HTML/" class="sidebar-heading clickable"><span>HTML</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用原生-js-实现事件委托"><a href="#使用原生-js-实现事件委托" class="header-anchor">#</a> 使用原生 JS 实现事件委托</h1> <h2 id="什么是事件委托"><a href="#什么是事件委托" class="header-anchor">#</a> 什么是事件委托?</h2> <p>用个例子就可以很简单的解释事件委托是怎么一回事了：</p> <blockquote><p>假设一个公司有三个职员在网上买了东西,那么他们三个在接收快递的时候有两种方法。
第一种：等快递来的时候,自己下楼去拿。
第二种：快递来的时候,先经过公司前台,然后在分发给每个人。
然而,正常情况下,第一种显然比较浪费劳动力,所以现实情况我们都采取第二种方法。
而且,第二种方法有个优势,新加入的职员也可以享受代签快递的服务。</p></blockquote> <p>我们把场景换到网页上：</p> <blockquote><p>假设一个网页中有三个li,并且绑定了事件,那么它们三个在触发事件的时候有两种方法。
第一种：当用户点击了li的时候,li触发事件
第二种：当用户点击了ul的时候,ul中的li触发事件
优势,显而易见就是新加入的li也可以通过ul触发。</p></blockquote> <p>也就是说事件委托,就是把本该由li触发的事件,交由ul代理。</p> <h2 id="为什么要用事件委托"><a href="#为什么要用事件委托" class="header-anchor">#</a> 为什么要用事件委托?</h2> <p>道理我都懂,可为什么要交给ul委托呢?我把每个li都绑定一遍不好吗?</p> <p><strong>一般来说，dom需要有事件处理程序，我们都会直接给它设事件处理程序就好了，那如果是很多的dom需要添加事件处理呢？比如我们有100个li，每个li都有相同的click点击事件，可能我们会用for循环的方法，来遍历所有的li，然后给它们添加事件，那这么做会存在什么影响呢？</strong></p> <p>在JavaScript中，添加到页面上的事件处理程序数量将直接关系到页面的整体运行性能，因为需要不断的与dom节点进行交互，访问dom的次数越多，引起浏览器重绘与重排的次数也就越多，就会延长整个页面的交互就绪时间，这就是为什么性能优化的主要思想之一就是减少DOM操作的原因；如果要用事件委托，就会将所有的操作放到js程序里面，与dom的操作就只需要交互一次，这样就能大大的减少与dom的交互次数，提高性能；</p> <p>每个函数都是一个对象，是对象就会占用内存，对象越多，内存占用率就越大，自然性能就越差了（内存不够用，是硬伤，哈哈），比如上面的100个li，就要占用100个内存空间，如果是1000个，10000个呢，那只能说呵呵了，如果用事件委托，那么我们就可以只对它的父级（如果只有一个父级）这一个对象进行操作，这样我们就需要一个内存空间就够了，是不是省了很多，自然性能就会更好。</p> <h2 id="事件委托的原理"><a href="#事件委托的原理" class="header-anchor">#</a> 事件委托的原理</h2> <h3 id="冒泡"><a href="#冒泡" class="header-anchor">#</a> 冒泡</h3> <p>事件委托是利用事件的冒泡原理来实现的，何为事件冒泡呢？举个例子：</p> <ol><li>先创建三个不同颜色的div,X&gt;Y&gt;Z
<img src="http://upload-images.jianshu.io/upload_images/4337988-37693187845a65bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="我们先创建三个div"></li> <li>然后分别给XYZ绑定事件
<img src="http://upload-images.jianshu.io/upload_images/4337988-45f36ee353bd2325.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="绑定事件"></li> <li>然后就可以测试冒泡事件了,我们先点击一下最里面的黄色div,发现三个事件都触发了
<img src="http://upload-images.jianshu.io/upload_images/4337988-01f625531f219e2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="三个事件都触发了"></li> <li>我们再点击一下绿色div,发现只触发了绿色div和红色div的事件.
<img src="http://upload-images.jianshu.io/upload_images/4337988-8561b9f82d4e7ba2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="只触发了绿色div和红色div的事件"></li> <li>所以我们可以总结,事件冒泡的规则就是事件从最深的节点开始，然后逐步向上传播事件。同时这也是事件委托，委托它们父级代为执行事件。</li></ol> <p><img src="http://upload-images.jianshu.io/upload_images/4337988-ef026ce54d376fb4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <h2 id="如何实现委托"><a href="#如何实现委托" class="header-anchor">#</a> 如何实现委托?</h2> <p>既然是委托,那么直接给li的父级ul绑定事件就可以了啊。但是这里存在一个BUG!
我们换个例子：
ul下有4个li,并且给ul绑定事件,为了方便演示给ul和li加一个border
<img src="http://upload-images.jianshu.io/upload_images/4337988-241d910a7679af62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p><strong>BUG就是当我们点击红色和绿色之间的时候也会触发事件!!!</strong></p> <p><img src="http://upload-images.jianshu.io/upload_images/4337988-fe134b3f88648ae4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p> <p>那么这个BUG如何处理呢?
<strong>如果在用户点击的时候判断一下是不是点击了li，如果是就触发，如果不是就不触发，是不是就解决了?</strong></p> <p><img src="http://upload-images.jianshu.io/upload_images/4337988-b1b6387fe832c2bd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="加一步判断">
这样看似成功了,只有点击了li才会触发事件.
<strong>但是并不完美,因为当li有子元素的时候就会失效!!!</strong></p> <p><img src="http://upload-images.jianshu.io/upload_images/4337988-fd45f15459ce67ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="这个时候点击选项1的时候并不触发事件"></p> <p>那么我们该如何继续优化呢?
当我们发现被点击的元素不是li的时候,那么我们就找被点击元素的父元素,判断它是不是li,如果不是就继续找.......以此类推,当我们找到li那么就触发事件,如果没找到,就不触发。</p> <p><img src="http://upload-images.jianshu.io/upload_images/4337988-826d7b2b9b2ad110.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="触发成功">
最终代码:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.a'</span><span class="token punctuation">)</span>
ul<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> 被点击的元素 <span class="token operator">=</span> e<span class="token punctuation">.</span>target
    <span class="token keyword">while</span> <span class="token punctuation">(</span>被点击的元素<span class="token punctuation">.</span>tagName <span class="token operator">!==</span> <span class="token string">'LI'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        被点击的元素 <span class="token operator">=</span> 被点击的元素<span class="token punctuation">.</span>parentNode
        <span class="token keyword">if</span> <span class="token punctuation">(</span>被点击的元素 <span class="token operator">===</span> ul<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            被点击的元素 <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>被点击的元素<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'触发成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/29/2020, 6:37:52 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/web/assets/js/app.8467f5ab.js" defer></script><script src="/web/assets/js/2.8d3b33bd.js" defer></script><script src="/web/assets/js/25.42103518.js" defer></script>
  </body>
</html>
