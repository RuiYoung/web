<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>解锁浏览器背后的运行机制(从浏览器背后的运行机制中着手性能优化) | 前端知识架构</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/web/favicon.ico">
    <meta name="description" content="一份耕耘，一份收获">
    <link rel="preload" href="/web/assets/css/0.styles.2154e1d6.css" as="style"><link rel="preload" href="/web/assets/js/app.8467f5ab.js" as="script"><link rel="preload" href="/web/assets/js/2.8d3b33bd.js" as="script"><link rel="preload" href="/web/assets/js/40.6b58055b.js" as="script"><link rel="prefetch" href="/web/assets/js/10.7a01bfe0.js"><link rel="prefetch" href="/web/assets/js/11.9434c272.js"><link rel="prefetch" href="/web/assets/js/12.9e6f10b2.js"><link rel="prefetch" href="/web/assets/js/13.fe0ef855.js"><link rel="prefetch" href="/web/assets/js/14.302f4517.js"><link rel="prefetch" href="/web/assets/js/15.660f56d4.js"><link rel="prefetch" href="/web/assets/js/16.46fc2947.js"><link rel="prefetch" href="/web/assets/js/17.d3cd12e3.js"><link rel="prefetch" href="/web/assets/js/18.8494a138.js"><link rel="prefetch" href="/web/assets/js/19.3a3d2df5.js"><link rel="prefetch" href="/web/assets/js/20.f5a53c39.js"><link rel="prefetch" href="/web/assets/js/21.030b82b6.js"><link rel="prefetch" href="/web/assets/js/22.d8388d13.js"><link rel="prefetch" href="/web/assets/js/23.fbc73fa5.js"><link rel="prefetch" href="/web/assets/js/24.e744a1f2.js"><link rel="prefetch" href="/web/assets/js/25.42103518.js"><link rel="prefetch" href="/web/assets/js/26.f7f69a1c.js"><link rel="prefetch" href="/web/assets/js/27.e99a3e44.js"><link rel="prefetch" href="/web/assets/js/28.909292b8.js"><link rel="prefetch" href="/web/assets/js/29.ad2475de.js"><link rel="prefetch" href="/web/assets/js/3.ccafea9f.js"><link rel="prefetch" href="/web/assets/js/30.d8597d9b.js"><link rel="prefetch" href="/web/assets/js/31.35764e69.js"><link rel="prefetch" href="/web/assets/js/32.bded8736.js"><link rel="prefetch" href="/web/assets/js/33.ed94c720.js"><link rel="prefetch" href="/web/assets/js/34.73a7c58c.js"><link rel="prefetch" href="/web/assets/js/35.513744f0.js"><link rel="prefetch" href="/web/assets/js/36.54a10e5d.js"><link rel="prefetch" href="/web/assets/js/37.0b875606.js"><link rel="prefetch" href="/web/assets/js/38.d1fd942d.js"><link rel="prefetch" href="/web/assets/js/39.391eb545.js"><link rel="prefetch" href="/web/assets/js/4.b7e6892f.js"><link rel="prefetch" href="/web/assets/js/41.18a47a08.js"><link rel="prefetch" href="/web/assets/js/42.bdc55719.js"><link rel="prefetch" href="/web/assets/js/43.ceab86cf.js"><link rel="prefetch" href="/web/assets/js/44.3f570633.js"><link rel="prefetch" href="/web/assets/js/45.cf947904.js"><link rel="prefetch" href="/web/assets/js/46.d54563a9.js"><link rel="prefetch" href="/web/assets/js/47.295b8176.js"><link rel="prefetch" href="/web/assets/js/48.dcecab73.js"><link rel="prefetch" href="/web/assets/js/49.30ed491b.js"><link rel="prefetch" href="/web/assets/js/5.98ae611d.js"><link rel="prefetch" href="/web/assets/js/6.a45f1e7c.js"><link rel="prefetch" href="/web/assets/js/7.749a3a54.js"><link rel="prefetch" href="/web/assets/js/8.17709c3b.js"><link rel="prefetch" href="/web/assets/js/9.69409426.js">
    <link rel="stylesheet" href="/web/assets/css/0.styles.2154e1d6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web/" class="home-link router-link-active"><!----> <span class="site-name">前端知识架构</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/web/basic/JavaScript/" class="nav-link">
  基础知识
</a></div><div class="nav-item"><a href="/web/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/web/net/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/web/performance/" class="nav-link router-link-active">
  性能优化
</a></div><div class="nav-item"><a href="/web/vue/" class="nav-link">
  Vue
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/web/basic/JavaScript/" class="nav-link">
  基础知识
</a></div><div class="nav-item"><a href="/web/browser/" class="nav-link">
  浏览器
</a></div><div class="nav-item"><a href="/web/net/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/web/performance/" class="nav-link router-link-active">
  性能优化
</a></div><div class="nav-item"><a href="/web/vue/" class="nav-link">
  Vue
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/web/performance/" class="sidebar-heading clickable router-link-active open"><span>前端性能优化</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/performance/browser-optimize.html" class="active sidebar-link">解锁浏览器背后的运行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/performance/browser-optimize.html#渲染过程" class="sidebar-link">渲染过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/performance/browser-optimize.html#基于渲染流程的-css-优化建议" class="sidebar-link">基于渲染流程的 CSS 优化建议</a></li><li class="sidebar-sub-header"><a href="/web/performance/browser-optimize.html#告别阻塞：css-与-js-的加载顺序优化" class="sidebar-link">告别阻塞：CSS 与 JS 的加载顺序优化</a></li></ul></li></ul></li><li><a href="/web/performance/cdn-optimize.html" class="sidebar-link">CDN 的缓存与回源机制解析</a></li><li><a href="/web/performance/dom-optimize.html" class="sidebar-link">DOM 优化原理与基本实践</a></li><li><a href="/web/performance/event-loop-optimize.html" class="sidebar-link">Event Loop 与异步更新策略</a></li><li><a href="/web/performance/picture-optimize.html" class="sidebar-link">图片优化——质量与性能的博弈</a></li><li><a href="/web/performance/process.html" class="sidebar-link">浏览器加载流程</a></li><li><a href="/web/performance/ssr-optimize.html" class="sidebar-link">服务端渲染的探索与实践</a></li><li><a href="/web/performance/storage-optimize.html" class="sidebar-link">本地存储——从 Cookie 到 Web Storage、IndexedD</a></li><li><a href="/web/performance/webpack-optimize.html" class="sidebar-link">webpack 性能调优与 Gzip 原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="解锁浏览器背后的运行机制-从浏览器背后的运行机制中着手性能优化"><a href="#解锁浏览器背后的运行机制-从浏览器背后的运行机制中着手性能优化" class="header-anchor">#</a> 解锁浏览器背后的运行机制(从浏览器背后的运行机制中着手性能优化)</h1> <blockquote><p>浏览器内核可以分成两部分：渲染引擎（Layout Engine 或者 Rendering Engine）和 JS 引擎
渲染引擎又包括了 HTML 解释器、CSS 解释器、布局、网络、存储、图形、音视频、图片解码器等等零部件</p> <blockquote><p>HTML 解释器：将 HTML 文档经过词法分析输出 DOM 树<br>
CSS 解释器：解析 CSS 文档, 生成样式规则。<br>
图层布局计算模块：布局计算每个对象的精确位置和大小。<br>
视图绘制模块：进行具体节点的图像绘制，将像素渲染到屏幕上。<br>
JavaScript 引擎：编译执行 Javascript 代码。</p></blockquote></blockquote> <h2 id="渲染过程"><a href="#渲染过程" class="header-anchor">#</a> 渲染过程</h2> <p><img src="/img/liucheng.png" alt="渲染过程"></p> <ul><li>DOM 树：解析 HTML 以创建的是 DOM 树（DOM tree ）：渲染引擎开始解析 HTML 文档，转换树中的标签到 DOM 节点，它被称为“内容树”。</li> <li>CSSOM 树：解析 CSS（包括外部 CSS 文件和样式元素）创建的是 CSSOM 树。CSSOM 的解析过程与 DOM 的解析过程是并行的。</li> <li>渲染树：CSSOM 与 DOM 结合，之后我们得到的就是渲染树（Render tree ）。</li> <li>布局渲染树：从根节点递归调用，计算每一个元素的大小、位置等，给每个节点所应该出现在屏幕上的精确坐标，我们便得到了基于渲染树的布局渲染树（Layout of the render tree）</li> <li>绘制渲染树: 遍历渲染树，每个节点将使用 UI 后端层来绘制。整个过程叫做绘制渲染树（Painting the render tree）。</li></ul> <p><strong>页面的初次渲染就大功告成之后，每当一个新元素加入到这个 DOM 树当中，浏览器便会通过 CSS 引擎查遍 CSS 样式表，找到符合该元素的样式规则应用到这个元素上，然后再重新去绘制它。</strong></p> <h3 id="基于渲染流程的-css-优化建议"><a href="#基于渲染流程的-css-优化建议" class="header-anchor">#</a> 基于渲染流程的 CSS 优化建议</h3> <p>CSS 选择符是从右到左进行匹配的。<br>
#myList  li {}    浏览器必须遍历页面上每个 li 元素，并且每次都要去确认这个 li 元素的父元素 id 是不是 myList，开销相当高</p> <p><strong>建议：</strong></p> <ul><li>避免使用通配符，只对需要用到的元素进行选择。</li> <li>关注可以通过继承实现的属性，避免重复匹配重复定义。</li> <li>少用标签选择器。如果可以，用类选择器替代</li> <li>不要画蛇添足，id 和 class 选择器不应该被多余的标签选择器拖后腿</li> <li>减少嵌套。后代选择器的开销是最高的，因此我们应该尽量将选择器的深度降到最低（最高不要超过三层），尽可能使用类来关联每一个标签元素</li></ul> <h3 id="告别阻塞：css-与-js-的加载顺序优化"><a href="#告别阻塞：css-与-js-的加载顺序优化" class="header-anchor">#</a> 告别阻塞：CSS 与 JS 的加载顺序优化</h3> <p>HTML、CSS 和 JS，都具有阻塞渲染的特性。<br>
HTML 阻塞，天经地义——没有 HTML，何来 DOM？没有 DOM，渲染和优化，都是空谈。</p> <h4 id="css-的阻塞"><a href="#css-的阻塞" class="header-anchor">#</a> CSS 的阻塞</h4> <p>DOM 和 CSSOM 合力才能构建渲染树。这一点会给性能造成严重影响：默认情况下，CSS 是阻塞的资源。浏览器在构建 CSSOM 的过程中，不会渲染任何已处理的内容。即便 DOM 已经解析完毕了，只要 CSSOM 不 OK，那么渲染这个事情就不 OK（这主要是为了避免没有 CSS 的 HTML 页面丑陋地“裸奔”在用户眼前）。</p> <p>开始解析 HTML 后、解析到 link 标签或者 style 标签时，CSS 才登场，CSSOM 的构建才开始。很多时候，DOM 不得不等待 CSSOM。因此我们可以这样总结：CSS 是阻塞渲染的资源。需要将它尽早、尽快地下载到客户端，以便缩短首次渲染的时间。尽早（将 CSS 放在 head 标签里）和尽快（启用 CDN 实现静态资源加载速度的优化）。这个“把 CSS 往前放”。</p> <h4 id="js-的阻塞"><a href="#js-的阻塞" class="header-anchor">#</a> JS 的阻塞</h4> <p>JS 的作用在于修改，它帮助我们修改网页的方方面面：内容、样式以及它如何响应用户交互。这“方方面面”的修改，本质上都是对 DOM 和 CSSDOM 进行修改。因此 JS 的执行会阻止 CSSOM，在我们不作显式声明的情况下，它也会阻塞 DOM。</p> <p>JS 引擎是独立于渲染引擎存在的。我们的 JS 代码在文档的何处插入，就在何处执行。当 HTML 解析器遇到一个 script 标签时，它会暂停渲染过程，将控制权交给 JS 引擎。JS 引擎对内联的 JS 代码会直接执行，对外部 JS 文件还要先获取到脚本、再进行执行。等 JS 引擎运行完毕，浏览器又会把控制权还给渲染引擎，继续 CSSOM 和 DOM 的构建。 因此与其说是 JS 把 CSS 和 HTML 阻塞了，不如说是 JS 引擎抢走了渲染引擎的控制权。</p> <h5 id="js的三种加载方式"><a href="#js的三种加载方式" class="header-anchor">#</a> JS的三种加载方式</h5> <ul><li>正常模式：这种情况下 JS 会阻塞浏览器，浏览器必须等待 index.js 加载和执行完毕才能去做其它事情</li> <li>async 模式：JS 不会阻塞浏览器做任何其它的事情。它的加载是异步的，当它加载结束，JS 脚本会立即执行。</li> <li>defer 模式：JS 的加载是异步的，执行是被推迟的。等整个文档解析完成、DOMContentLoaded 事件即将被触发时，被标记了 defer 的 JS 文件才会开始依次执行。</li></ul> <p><strong>从应用的角度来说，一般当我们的脚本与 DOM 元素和其它脚本之间的依赖关系不强时，我们会选用 async；当脚本依赖于 DOM 元素和其它脚本的执行结果时，我们会选用 defer。</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/29/2020, 6:37:52 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/web/performance/cdn-optimize.html">
        CDN 的缓存与回源机制解析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/web/assets/js/app.8467f5ab.js" defer></script><script src="/web/assets/js/2.8d3b33bd.js" defer></script><script src="/web/assets/js/40.6b58055b.js" defer></script>
  </body>
</html>
